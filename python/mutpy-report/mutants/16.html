<!DOCTYPE html>
<html>
<head>
    <title>MutPy mutation report - mutation #16</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css" />
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script>
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js" type="text/javascript"></script>
<script type="text/javascript">
    SyntaxHighlighter.all();
    window.setTimeout(function () {
        
        $('.line.number121').attr('title', 'ROR');
        
    }, 0);
</script>

</head>
<body>
    <div class="container">
        
<div class="page-header">
    <h1>Mutation #16</h1>
</div>
<h3>Details</h3>
<ul>
    <li>module - <code><module 'gilded_rose' from 'C:\\Users\\Thiago Andrade\\Documents\\GitHub\\GildedRose-Refactoring-Kata\\python\\gilded_rose.py'></code></li>
    <li><span class="label label-success">killed</span> by <code>tests/test_gilded_rose.py::GildedRoseTest::test_aged_brie_quality_49_after_sell</code></li>
    
    <li>duration - 0.206 s</li>
    
    
    <li>tests run - 5</li>
    
</ul>

<h3>Exception traceback</h3>
<pre>self = <tests.test_gilded_rose.GildedRoseTest testMethod=test_aged_brie_quality_49_after_sell>

    def test_aged_brie_quality_49_after_sell(self):
        """Aged Brie at quality 49 after sell date caps at 50 (not 51)."""
        items = [Item("Aged Brie", -1, 49)]
        gilded_rose = GildedRose(items)
        gilded_rose.update_quality()
>       self.assertEqual(50, items[0].quality)
E       AssertionError: 50 != 51

tests\test_gilded_rose.py:131: AssertionError</pre>

<h3>Mutations</h3>
<ul>
    
    <li>ROR - line 121</li>
    
</ul>
<h3>Mutant</h3>
<pre class="brush: python; first-line: 2; highlight: [121]; toolbar: false;">
'''Gilded Rose Inventory Management System.

This module implements the quality update logic for various item types
in the Gilded Rose inventory system using the Strategy Pattern.
'''


AGED_BRIE = 'Aged Brie'
BACKSTAGE_PASSES = 'Backstage passes to a TAFKAL80ETC concert'
SULFURAS = 'Sulfuras, Hand of Ragnaros'


MIN_QUALITY = 0
MAX_QUALITY = 50
SULFURAS_QUALITY = 80


class GildedRose:
    '''Manages quality updates for inventory items.
    
    Uses the Strategy Pattern to apply item-specific update rules.
    '''
    
    def __init__(self, items):
        '''Initialize the Gilded Rose system with a list of items.
        
        Args:
            items: List of Item objects to manage.
        '''
        self.items = items
        self.update_strategies = self._build_update_strategies()
    
    def _build_update_strategies(self):
        '''Build strategy dictionary mapping item names to update methods.
        
        Returns:
            Dictionary mapping item names to their update methods.
        '''
        return {\
            AGED_BRIE: self._update_aged_brie, \
            BACKSTAGE_PASSES: self._update_backstage_pass, \
            SULFURAS: self._update_sulfuras}
    
    
    def update_quality(self):
        '''Update quality and sell_in for all items according to business rules.'''
        for item in self.items:
            strategy = self.update_strategies.get(item.name, self._update_normal_item)
            strategy(item)
    
    def _update_normal_item(self, item):
        '''Update quality for normal items.
        
        Normal items degrade by 1 before sell date, by 2 after.
        
        Args:
            item: Item to update.
        '''
        self._decrease_quality(item)
        self._decrease_sell_in(item)
        
        if self._is_expired(item):
            self._decrease_quality(item)
    
    def _update_aged_brie(self, item):
        '''Update quality for Aged Brie.
        
        Aged Brie improves by 1 before sell date, by 2 after.
        
        Args:
            item: Item to update.
        '''
        self._increase_quality(item)
        self._decrease_sell_in(item)
        
        if self._is_expired(item):
            self._increase_quality(item)
    
    def _update_backstage_pass(self, item):
        '''Update quality for Backstage passes.
        
        Quality increases by:
        - 1 when more than 10 days remain
        - 2 when 10 days or less remain
        - 3 when 5 days or less remain
        - Drops to 0 after concert (sell_in < 0)
        
        Args:
            item: Item to update.
        '''
        self._increase_quality(item)
        
        if item.sell_in < 11:
            self._increase_quality(item)
        
        if item.sell_in < 6:
            self._increase_quality(item)
        
        self._decrease_sell_in(item)
        
        if self._is_expired(item):
            item.quality = MIN_QUALITY
    
    def _update_sulfuras(self, item):
        '''Update quality for Sulfuras (legendary item).
        
        Sulfuras never changes quality or sell_in.
        
        Args:
            item: Item to update (no changes made).
        '''
        pass
    
    def _increase_quality(self, item):
        '''Increase item quality by 1, respecting maximum bound.
        
        Args:
            item: Item whose quality to increase.
        '''
        if item.quality <= MAX_QUALITY:
            item.quality += 1
    
    def _decrease_quality(self, item):
        '''Decrease item quality by 1, respecting minimum bound.
        
        Args:
            item: Item whose quality to decrease.
        '''
        if item.quality > MIN_QUALITY:
            item.quality -= 1
    
    def _decrease_sell_in(self, item):
        '''Decrease item sell_in by 1.
        
        Args:
            item: Item whose sell_in to decrease.
        '''
        item.sell_in -= 1
    
    def _is_expired(self, item):
        '''Check if item has passed its sell date.
        
        Args:
            item: Item to check.
            
        Returns:
            True if item.sell_in < 0, False otherwise.
        '''
        return item.sell_in < 0


class Item:
    '''Represents an inventory item with name, sell_in, and quality.'''
    
    def __init__(self, name, sell_in, quality):
        '''Initialize an inventory item.
        
        Args:
            name: Name of the item.
            sell_in: Days until sell date (negative means expired).
            quality: Quality value of the item.
        '''
        self.name = name
        self.sell_in = sell_in
        self.quality = quality
    
    def __repr__(self):
        '''Return string representation of item.
        
        Returns:
            String in format "name, sell_in, quality".
        '''
        return f'{self.name}, {self.sell_in}, {self.quality}'</pre>

    </div>
</body>
</html>